---
title: "Analyzing Burki's Performances for Borussia Dortmund"
output: 
  html_notebook: 
    theme: yeti
---

Roman Burki has had a very up and down time as BVB goalkeeper, going fro much maligned, to the star of the show, and back again. At this point, it's a little hard to work out exactly what the view of him is among fans. But it seems as though it is net negative.

Generally speaking, when it comes to fan judgments, I find myself on the outside looking in. I think fans tend to be a little too reactionary, having a positive view one week, followed by a negative the following week. But in Burki's case, I've been on the ride along with everyone else. I'm still not really sure how I feel about him.

However, my inkling is that he is a good but not good enough goalkeeper.

## Loading & Preparing Data

```{r}
# packages
pacman::p_load(
  tidyverse, devtools, bbplot,
  scales, ggimage, ggrepel, ggalt,
  ggtext, ggforce, glue, concaveman
)
```

```{r}
# data
burki <- read_csv("burki/buli_keepers.csv")
# wrangling
total_comp <- burki %>%
  group_by(player, surname) %>%
  summarise(
    mins = sum(mins), psxg = sum(psxg), psxg90 = mean(psxg90),
    psxg_sot = mean(psxg_sot), psxg_plus_minus = sum(psxg_plus_minus),
    ga = sum(ga), ga90 = mean(ga90), sota = sum(sota), sota90 = mean(sota90),
    cross_stp = sum(cross_stp), cross_stp_perc = mean(cross_stp_perc),
    .groups = "keep"
  ) %>%
  filter(mins > 3500)

```

## Analyzing Goalkeeper Performance from 17/18 to 20/21

### Post-Shot Expected Goals

```{r psxg vs goals against, eval=FALSE, fig.width=12, include=FALSE}
# exploratory analysis

ggplot(total_comp, aes(psxg90, ga90)) +
  geom_point(size = 4, alpha = 0.8) +
  geom_text(aes(label = surname),
    nudge_y = 0.05,
    check_overlap = F
  ) +
  geom_jitter(alpha = 0.8) +
  bbc_style() +
  theme(
    plot.title = element_markdown(size = 18),
    plot.subtitle = element_markdown(size = 16),
    axis.title = element_markdown(size = 14),
    axis.text = element_markdown(size = 14),
    panel.grid.major.x = element_line(color = "#cbcbcb"),
    panel.grid.major.y = element_blank()
  ) +
  labs(
    title = glue("Post Shot Expected Goals +/- Per 90 (PSxG/90) 
                 vs Goals Conceded Per 90 (GA/90)"),
    subtitle = "Comparing Goalkeeper Performance | Bundesliga 18/19 - 19/20",
    x = "PSxG/90", y = "GA/90"
  )
```
```{r over/underperformance, fig.width=12}
# dumbbell plot
total_comp %>%
  mutate(gap = psxg - ga) %>%
  arrange(desc(gap)) %>%
  ggplot(aes(x = ga, xend = psxg, y = reorder(surname, gap))) +
  geom_dumbbell(
    colour = "#dddddd",
    size = 6,
    colour_x = "#e63946",
    colour_xend = "#457b9d",
    alpha = 0.8,
    dot_guide = TRUE, dot_guide_size = 0.15
  ) +
  bbc_style() +
  labs(
    title = glue("Goalkeeper Performance
                     Above/Below Expectations |
                     Bundesliga 17/18 - 20/21"),
    subtitle = glue("PSxG - Goals Conceded |
                        Ranking Keepers on Performance
                       from Better to Worse than Expected"),
    x = glue("Goals Total (<b style='color:#457B9D'>Expected</b>
                 vs <b style='color:#E63946'>Conceded</b>)"),
    y = NULL
  ) +
  theme(
    plot.title = element_markdown(size = 18),
    plot.subtitle = element_markdown(size = 16),
    axis.title = element_markdown(size = 14),
    axis.text = element_markdown(size = 12),
    axis.title.x = element_markdown(size = 14),
    panel.grid.major.x = element_line(color = "#cbcbcb"),
    panel.grid.major.y = element_blank()
  )
```
```{r psxg totals, fig.width=12}
# psxg +/- performance
total_comp %>%
  mutate(comp_color = ifelse(psxg_plus_minus > 0, "type1", "type2")) %>%
  ggplot(aes(x = reorder(surname, psxg_plus_minus), y = psxg_plus_minus)) +
  geom_segment(aes(
    x = 0, xend = psxg_plus_minus,
    y = reorder(surname, psxg_plus_minus),
    yend = reorder(surname, psxg_plus_minus),
    color = comp_color
  ), size = 5, alpha = 0.8) +
  bbc_style() + scale_color_manual(values = c("#457b9d", "#e63946")) +
  labs(
    title = glue("Comparing Total Post-Shot Expected Goals +/- (PSxG +/-) | Bundesliga 17/18 - 20/21"),
    subtitle = glue("Measuring Goalkeeper Performance Above/Below Expectations in the Last Four Seasons"),
    x = "PSxG +/-"
  ) +
  theme(
    legend.position = "none",
    plot.title = element_markdown(size = 18),
    plot.subtitle = element_markdown(size = 16),
    axis.text = element_markdown(size = 12),
    axis.title.x = element_markdown(size = 12),
    panel.grid.major.x = element_line(color = "#cbcbcb"),
    panel.grid.major.y = element_blank()
  )

```
### Shot-Stopping & Workload

```{r plot labels}
# create plot labels
burkineuer_desc <- glue("Both goalkeepers face relatively few shots,
                        but appear to be slightly underperforming")

gulascisommer_desc <- glue("Two of the best goalkeepers
                             in Europe in the last two seasons")
```

```{r shot stopping, fig.width=14}

ggplot(total_comp, aes(x = psxg90, y = sota90)) +
  geom_vline(xintercept = 0, linetype = "dashed") +
  geom_hline(yintercept = 4.687, linetype = "dashed") +
  annotate("text",
    x = -0.3375, y = 6.75, hjust = 0, size = 6,
    label = "Busy & Underperforming"
  ) +
  annotate("text",
    x = -0.3375, y = 2.25, hjust = 0, size = 6,
    label = "Not Busy & Underperforming"
  ) +
  annotate("text",
    x = 0.1175, y = 2.25, hjust = 0, size = 6,
    label = "Not Busy & Overperforming"
  ) +
  annotate("text",
    x = 0.1175, y = 6.75, hjust = 0, size = 6,
    label = "Busy & Overperforming"
  ) +
  geom_point(aes(),
    shape = 21, size = 5,
    color = "#e63946", alpha = 0.8, stroke = 1.5
  ) +
  geom_text_repel(
    data = total_comp %>%
      filter(!surname %in%
        c("Burki", "Gulacsi", "Sommer", "Neuer")),
    aes(label = surname),
    min.segment.length = 0.3, seed = 15, size = 5,
    point.padding = 0.2, segment.alpha = 0, color = "grey20"
  ) +
  geom_mark_hull(
    aes(
      filter = surname %in% c("Burki", "Neuer"),
      label = "Bürki & Neuer",
      description = burkineuer_desc
    ),
    expand = unit(5, "mm"), con.cap = unit(0, "mm"),
    label.width = unit(85, "mm"), label.buffer = unit(0.1, "mm"),
    label.fontsize = c(14, 12), label.colour = "grey20"
  ) +
  geom_mark_hull(
    aes(
      filter = surname %in% c("Gulacsi", "Sommer"),
      label = "Gulácsi & Sommer",
      description = gulascisommer_desc
    ),
    expand = unit(5, "mm"), con.cap = unit(0, "mm"),
    label.width = unit(80, "mm"), label.buffer = unit(16, "mm"),
    label.fontsize = c(14, 12), label.colour = "grey20"
  ) +
  labs(
    title = glue("Goalkeeper Shot-Stopping Performance & Workload |
                     Bundesliga 17/18 - 20/21"),
    subtitle = glue("Comparing PSxG +/- & Shots on Target Against (SoTA) Per 90 | Minimum 3500 Minutes Played"),
    x = "PSxG +/-",
    y = "SoTA",
    caption = "Data: FBref | StatsBomb"
  ) +
  scale_x_continuous(
    labels = seq(-0.4, 0.3, 0.1),
    breaks = seq(-0.4, 0.3, 0.1),
    limits = c(-0.4, 0.3),
    expand = c(0.01, 0)
  ) +
  scale_y_continuous(
    labels = seq(2, 7, 1),
    breaks = seq(2, 7, 1),
    limits = c(2, 7),
    expand = c(0.01, 0)
  ) +
  bbc_style() +
  theme(
    plot.title = element_markdown(size = 20),
    plot.subtitle = element_markdown(size = 16),
    plot.caption = element_text(size = 14, color = "#a8a8a8"),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12)
  )


```

### Considering a Goalkeeper's Other Responsibilities

- Look at distribution, actions outside the penalty area, and claiming crosses
- Use measures of ball progression, contribution to buildup, and maybe chance creation for distribution (as well as looking at pass completion, touches etc. to show their involvement)
- When looking at actions outside the penalty area, also look at the number of shots they're facing, and maybe look at the team touches in defensive and mid third to consider whether the goalkeeper affords team a chance to play a higher line?
- What about claiming crosses?

## Analyzing Performance So Far This Season

- Less detailed analysis looking at Burki's performances so far this season, and considering how he compares to others?

### PSxG
### Workload
### Distribution & Claiming Crosses